#!/usr/bin/env zsh

currentDirectory=$(pwd)

cd ~/Development/Git.Repositories/nixos

# Symlinks the secrets file in place
storePath=$(nix-store --add-fixed sha256 "./secrets/secrets.yaml")
sudo mkdir "/.secrets"
sudo ln -s $storePath "/.secrets/secrets.yaml"

# Rebuilds the system
sudo nixos-rebuild switch --flake .

cd $currentDirectory
