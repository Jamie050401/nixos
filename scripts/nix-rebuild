#!/usr/bin/env zsh

# Handles parameters passed into the script
directory="/tmp/Git.Repositories/nixos"
while [[ "$#" -gt 0 ]]
do case $1 in
    -h|--hostName) hostName=$2
    shift;;
    *) echo "Unknown parameter: $1"
    shift;; 
esac
shift
done

currentDirectory=$(pwd)
sudo mkdir -p $directory
sudo git -C pull $directory || sudo git clone "git@github.com:Jamie050401/nixos.git" $directory
sudo nixos-rebuild switch --flake .#$hostName
cd $currentDirectory
